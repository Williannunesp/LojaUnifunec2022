CREATE DOMAIN NOMES VARCHAR(120) NOT NULL;

CREATE TABLE SEXO (
	CODSEXO SERIAL PRIMARY KEY,
	NOMESEXO NOMES UNIQUE	
);

CREATE TABLE RUA (
	CODRUA SERIAL PRIMARY KEY,
	NOMERUA NOMES UNIQUE	
);

CREATE TABLE BAIRRO (
	CODBAIRRO SERIAL PRIMARY KEY,
	NOMEBAIRRO NOMES UNIQUE	
);

CREATE TABLE CEP (
	CODCEP SERIAL PRIMARY KEY,
	NOMECEP NOMES UNIQUE
);

CREATE TABLE UF (
	CODUF SERIAL PRIMARY KEY,
	NOMEUF NOMES UNIQUE,
	SIGLA CHAR (2) UNIQUE NOT NULL
);

CREATE TABLE TRABALHO (
	CODTRABALHO SERIAL PRIMARY KEY,
	NOMETRABALHO NOMES UNIQUE	
);

CREATE TABLE CIDADE(
	CODCIDADE SERIAL PRIMARY KEY,
	NOMECIDADE NOMES UNIQUE,
	CODUF_FK INTEGER REFERENCES UF(CODUF) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE

);

CREATE TABLE CLIENTE (
	CODCLIENTE SERIAL PRIMARY KEY,
	NOMECLIENTE NOMES,
	DATA_NASC DATE NOT NULL,
	CODSEXO_FK INTEGER REFERENCES SEXO(CODSEXO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE, 
	CODBAIRRO_FK INTEGER REFERENCES BAIRRO(CODBAIRRO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCEP_FK INTEGER REFERENCES CEP(CODCEP) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCIDADE_FK INTEGER REFERENCES CIDADE(CODCIDADE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
        CODRUA_FK INTEGER REFERENCES RUA(CODRUA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
        CODTRABALHO_FK INTEGER REFERENCES TRABALHO(CODTRABALHO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
        NUMEROCASA VARCHAR(6)
);

CREATE TABLE OPERADORA(
	CODOPERADORA SERIAL PRIMARY KEY,
	NOMEOPERADORA NOMES UNIQUE
	
);


CREATE TABLE TELEFONE(
	CODTELEFONE SERIAL PRIMARY KEY,
	NUMERO VARCHAR(15),
	CODOPERADORA_FK INTEGER REFERENCES OPERADORA(CODOPERADORA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ITENSCLIENTE(
	CODTELEFONE_FK INTEGER REFERENCES TELEFONE(CODTELEFONE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCLIENTE_FK INTEGER REFERENCES CLIENTE(CODCLIENTE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);
 ALTER TABLE ITENSCLIENTE ADD CONSTRAINT PK_COMPOSTA_IC PRIMARY KEY (CODTELEFONE_FK, CODCLIENTE_FK);

CREATE TABLE ITENSTELEFONETRABALHO(
	CODTRABALHO_FK INTEGER REFERENCES TRABALHO(CODTRABALHO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODTELEFONE_FK INTEGER REFERENCES TELEFONE(CODTELEFONE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);
	ALTER TABLE ITENSTELEFONETRABALHO ADD CONSTRAINT PK_COMPOSTA_ITT PRIMARY KEY (CODTRABALHO_FK, CODTELEFONE_FK);

CREATE TABLE FUNCAO(
	CODFUNCAO SERIAL PRIMARY KEY,
	NOMEFUNCAO NOMES UNIQUE
);


CREATE TABLE LOJA(
	CODLOJA SERIAL PRIMARY KEY,
	NOMELOJA NOMES UNIQUE,
	CNPJ VARCHAR(18) NOT NULL UNIQUE,
	NOMEFANTASIA NOMES UNIQUE,
	RAZAOSOCIAL NOMES UNIQUE

);

CREATE TABLE ITENSTELEFONELOJA(
	CODLOJA_FK INTEGER REFERENCES LOJA(CODLOJA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODTELEFONE_FK INTEGER REFERENCES TELEFONE(CODTELEFONE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE 

);

ALTER TABLE ITENSTELEFONELOJA ADD CONSTRAINT PK_COMPOSTA_ITL PRIMARY KEY(CODLOJA_FK, CODTELEFONE_FK);

CREATE TABLE FUNCIONARIOS(
	CODFUNCIONARIO SERIAL PRIMARY KEY,
	NOMEFUNCIONARIO NOMES ,
	NUMEROCASA VARCHAR(6),
        CODRUA_FK INTEGER REFERENCES RUA(CODRUA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODBAIRRO_FK INTEGER REFERENCES BAIRRO(CODBAIRRO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCEP_FK INTEGER REFERENCES CEP(CODCEP) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCIDADE_FK INTEGER REFERENCES CIDADE(CODCIDADE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODFUNCAO_FK INTEGER REFERENCES FUNCAO(CODFUNCAO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	SALARIO VARCHAR(5) NOT NULL,
	CODLOJA_FK INTEGER REFERENCES LOJA(CODLOJA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ITENSTELFUNCIONARIO (
	CODFUNCIONARIO_FK INTEGER REFERENCES FUNCIONARIOS(CODFUNCIONARIO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODTELEFONE_FK INTEGER REFERENCES TELEFONE(CODTELEFONE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE ITENSTELEFONEFUNCIONARIO ADD CONSTRAINT PK_COMPOSTA_ITF PRIMARY KEY (CODFUNCIONARIO_FK, CODTELEFONE_FK);


CREATE TABLE FORNECEDOR(
	CODFORNECEDOR SERIAL PRIMARY KEY,
	NOMEFORNECEDOR NOMES,
	NUMEROCASA VARCHAR(5) NOT NULL,
	CODRUA_FK INTEGER REFERENCES RUA(CODRUA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODBAIRRO_FK INTEGER REFERENCES BAIRRO(CODBAIRRO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCEP_FK INTEGER REFERENCES CEP(CODCEP) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODCIDADE_FK INTEGER REFERENCES CIDADE(CODCIDADE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
	);


CREATE TABLE ITENSTELFORNECEDOR (
	CODTELEFONE_FK INTEGER REFERENCES TELEFONE(CODTELEFONE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODFORNECEDOR_FK INTEGER REFERENCES FORNECEDOR(CODFORNECEDOR) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
	);

ALTER TABLE ITENSTELEFONEFORNECEDOR ADD CONSTRAINT PK_COMPOSTA_ITFORN PRIMARY KEY (CODTELEFONE_FK, CODFORNECEDOR_FK);


CREATE TABLE LOGIN(
	CODLOGIN SERIAL PRIMARY KEY,
	USUARIO VARCHAR(50) NOT NULL UNIQUE,
	SENHA VARCHAR(120) NOT NULL,
	CODFUNCINARIO_FK INTEGER REFERENCES FUNCIONARIOS(CODFUNCIONARIO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE ACESSO(
	CODACESSO SERIAL PRIMARY KEY,
	NOMEACESSO NOMES UNIQUE
);



CREATE TABLE ITENSACESSOLOGIN(
	CODACESSO_FK INTEGER REFERENCES ACESSO(CODACESSO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODLOGIN_FK INTEGER REFERENCES LOGIN(CODLOGIN) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);
ALTER TABLE ITENSACESSOLOGIN ADD CONSTRAINT PK_COMPOSTA_IAL PRIMARY KEY (CODACESSO_FK, CODLOGIN_FK);




CREATE TABLE CONTROLELOGSISTEMA (
	CODCONTROLE SERIAL PRIMARY KEY,
	CODLOGIN_FK INTEGER REFERENCES LOGIN(CODLOGIN) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	DATA_LOG DATE,
	HORA TIME
	
);

CREATE TABLE MARCA (
	CODMARCA SERIAL PRIMARY KEY,
	NOMEMARCA NOMES UNIQUE

);


CREATE TABLE TIPO ( 
	CODTIPO SERIAL PRIMARY KEY,
	NOMETIPO NOMES UNIQUE
);


CREATE TABLE PRODUTO (
	CODPRODUTO SERIAL PRIMARY KEY,
	N0MEPRODUTO NOMES UNIQUE,
	QUANTIDADE NUMERIC (10,2) NOT NULL,
	VALOR NUMERIC(10,2) NOT NULL,
	CODMARCA INTEGER REFERENCES MARCA(CODMARCA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODTIPO INTEGER REFERENCES TIPO(CODTIPO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE 
);

CREATE TABLE COMPRAPRODUTO(
	CODCOMPRA SERIAL PRIMARY KEY,
	DATACOMPRA DATE,
	CODFORNECEDOR_FK INTEGER REFERENCES FORNECEDOR(CODFORNECEDOR) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODFUNCIONARIO_FK INTEGER REFERENCES FUNCIONARIOS(CODFUNCIONARIO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE 

);

CREATE TABLE ITENSCOMPRAPRODUTO (
	CODCOMPRA_FK INTEGER REFERENCES COMPRAPRODUTO(CODCOMPRA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODPRODUTO_FK INTEGER REFERENCES PRODUTO(CODPRODUTO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	QUANTIDADE NUMERIC (10,2) NOT NULL,
	VALORC NUMERIC(10,2) NOT NULL
);

ALTER TABLE ITENSCOMPRAPRODUTO ADD CONSTRAINT PK_COMPOSTA_ICP PRIMARY KEY (CODCOMPRA_FK, CODPRODUTO_FK);

CREATE TABLE SITUACAO(
	CODSITUACAO SERIAL PRIMARY KEY,
	NOMESITUACAO NOMES UNIQUE
);



CREATE TABLE PARCELACOMPRA(
	CODPARCELACOMPRA SERIAL PRIMARY KEY,
	DATAVENCIMENTO DATE NOT NULL,
	VALOR NUMERIC(10,2) NOT NULL,
	CODSITUACAO_FK INTEGER REFERENCES SITUACAO(CODSITUACAO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE, 
	CODCOMPRA_FK INTEGER REFERENCES COMPRAPRODUTO(CODCOMPRA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE VENDAPRODUTO(
	CODVENDA SERIAL PRIMARY KEY,
	DATAVENDA DATE NOT NULL,
	CODCLIENTE_FK INTEGER REFERENCES CLIENTE(CODCLIENTE) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODFUNCIONARIO_FK INTEGER REFERENCES FUNCIONARIOS(CODFUNCIONARIO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ITENSVENDAPRODUTO (
	CODVENDA_FK INTEGER REFERENCES VENDAPRODUTO(CODVENDA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODPRODUTO_FK INTEGER REFERENCES PRODUTO(CODPRODUTO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	QUANTIDADE NUMERIC (10,2) NOT NULL,
	VALOR NUMERIC (10,2) NOT NULL

);

ALTER TABLE ITENSVENDAPRODUTO ADD CONSTRAINT PK_COMPOSTA_IVP PRIMARY KEY (CODPRODUTO_FK, CODVENDA_FK);


CREATE TABLE PARCELAVENDA(
	CODPARCELA SERIAL PRIMARY KEY,
	DATAVENCIMENTO VARCHAR(10) NOT NULL,
	VALOR NUMERIC (10,2) NOT NULL,
	CODSITUACAO_FK INTEGER REFERENCES SITUACAO(CODSITUACAO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE,
	CODVENDA_FK INTEGER REFERENCES VENDAPRODUTO(CODVENDA) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IMAGENS(
	CODIMAGENS SERIAL PRIMARY KEY,
	IMAGEM BYTEA,
	DESCRICAO TEXT NOT NULL,
	CODPRODUTO_FK INTEGER REFERENCES PRODUTO(CODPRODUTO) MATCH SIMPLE ON DELETE CASCADE ON UPDATE CASCADE	

);
